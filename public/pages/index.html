<!DOCTYPE html>
<html>
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
        <script src="/bower_components/webcomponentsjs/webcomponents.js"></script>
        <link rel="import" href="/bower_components/polymer/polymer.html">
        
        <link rel="import" href="/bower_components/app-router/app-router.html">
        <link rel="import"
              href="/bower_components/font-roboto/roboto.html">
        <link rel="import"
              href="/bower_components/paper-tabs/paper-tabs.html">

        <link rel="stylesheet" href="styles.css" shim-shadowdom>
        <title>
            Shell
        </title>

    </head>
    <body unresolved>
     
    <polymer-element name="index-app">
        <template>
            <!-- bind the session object to index--page -->
            <user-session session="{{session}}"></user-session>

            <app-router mode="pushstate" init="manual" id="router" on-state-change="{{stateChange}}">
                <app-route path="/" import="/pages/index.html" on-before-data-binding="{{bindSession}}"></app-route>
                <app-route path="/signin" bindRouter import="/pages/signin-page.html"  on-before-data-binding="{{bindSession}}"></app-route>
                
                <app-route path="/home" import="/pages/home-page.html"></app-route>
                <app-route path="*" import="/pages/not-found-page.html"></app-route>
            </app-router>

        </template>
        <script>
            Polymer('index-app', {
                init: function(){
//                    console.log(this.$.router);
                    this.$.router.init();  
                },
                stateChange: function(event) {
                    
                    //console.log(this.session);
                    // redirect to the login page if not signed in
                    if (!this.session && event.detail.path !== '/signin') {
                        event.preventDefault();
                        this.$.router.go('/signin');
                    }
                },
                bindSession: function(event) {
                    // update the route's model before it's bound to the home-page or login-page
                    event.detail.model.session = this.session;
                }
            });
        </script>
    </polymer-element>
    <index-app></index-app>  
    <script>
        window.addEventListener('WebComponentsReady', function() {
            var app = document.querySelector('index-app');
//            console.log("Error");
//            console.log(app);
            app.init();
        });
    </script>
</body>
</html>