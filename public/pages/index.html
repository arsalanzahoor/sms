<!DOCTYPE html>
<html>
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
        <script src="/bower_components/webcomponentsjs/webcomponents.js"></script>
        <link rel="import" href="/bower_components/polymer/polymer.html">

        <link rel="import" href="/bower_components/core-localstorage/core-localstorage.html">
        <link rel="import" href="/bower_components/app-router/app-router.html">
        <link rel="import" href="/bower_components/font-roboto/roboto.html">
        <link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
        <link rel="import" href="/bower_components/baasic-ajax/baasic-ajax.html">
        <link rel="import" href="/bower_components/baasic-globals/baasic-globals.html">
        <!--<link rel="import" href="/bower_components/baasic-login/baasic-login.html">-->


        <link rel="stylesheet" href="styles.css" shim-shadowdom>
        <title>
            Shell
        </title>

    </head>
    <body unresolved>

    <polymer-element name="index-app">
        <template>
            <!--<baasic-login id="log"></baasic-login>-->
            <baasic-globals id="globals"></baasic-globals>
            <!-- bind the session object to index--page -->
            <user-session session="{{session}}"></user-session>

            <app-router mode="hash" init="manual" id="router" on-state-change="{{stateChange}}">
                <app-route path="/" import="/pages/index.html" on-before-data-binding="{{bindSession}}"></app-route>
                <app-route path="/signin" bindRouter import="/pages/signin-page.html"  on-before-data-binding="{{bindSession}}"></app-route>
                <!--<app-route path="/signin" bindRouter import="/pages/baasic-login.html"  on-before-data-binding="{{bindSession}}"></app-route>-->
                <app-route path="/home" bindRouter import="/pages/home-page.html" ></app-route>
                <app-route path="/employees" bindRouter import="/pages/employees-page.html" ></app-route>
                <app-route path="/attendance" bindRouter import="/pages/attendance-page.html" ></app-route>
                <app-route path="/admin" bindRouter import="/pages/admin-page.html" ></app-route>
                <app-route path="/signout" bindRouter on-activate-route-start="{{logOut}}" ></app-route>
                <app-route path="*" import="/pages/not-found-page.html"></app-route>
            </app-router>
            <!--<core-localstorage id="storage" name="polymer-localstorage-app-session" value="{{session}}"></core-localstorage>-->

        </template>

        <script>
            Polymer('index-app', {
                //                ready:function(){
                //                  console.log(this.$.globals);
                //                },
                init: function(){
                    //                    console.log(this.$.router);
                    //                    console.log(this.$.globals)
                    this.$.router.init();  
                },
                stateChange: function(event) {
                    
                    //console.log(event);
                    // redirect to the login page if not signed in
                    if (!this.session && event.detail.path !== '/signin') {
                        event.preventDefault();
                        //console.log(event.preventDefault());
                        this.$.router.go('/signin');
                        
                    }
                    
                },
                bindSession: function(event) {
                    //var appSession = this.$.localstorage.session.value;
                    // update the route's model before it's bound to the home-page or login-page
                    //console.log(this.$.session);
                    event.detail.model.session = this.$.session;
                },
                logOut : function(){
                    this.$.globals.logOut();
                    //                      console.log("test");
                    //                    this.$.session = false;
                    //                    this.$.router.go('/signin');
                }
            });
        </script>
    </polymer-element>
    <index-app></index-app>  
    <script>
        window.addEventListener('WebComponentsReady', function() {
            var app = document.querySelector('index-app');
            //            console.log("Error");
            //            console.log(app.$.globals.baasicUser);
            //            this.globals = this.$.globals;
            //            console.log(this.$.globals);
            if(app.session)
            {
                //                console.log(app.$.globals.baasicUser); 
                app.$.router.go('/home');
            }
            app.init();
        });
    </script>
</body>
</html>