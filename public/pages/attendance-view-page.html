<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/page-er/page-er.html">
<!--<link rel="import" href="/bower_components/polymer-filters/polymer-filters.html">-->
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/core-label/core-label.html">
<link rel="import" href="/layouts/sidebar-layout.html">
<link rel="import" href="/pages/app-ajax.html">
<script src="/bower_components/moment/moment.js"></script>
<script src="/pages/date.js"></script>

<polymer-element name="attendance-view-page" router="{{router}}" attributes="employeeattendance employeeheaders todate fromdate employeeid">
    <template>
        <baasic-globals id="globals"></baasic-globals>
        <sidebar-layout selected="attendance-view">
            <div class="title">Attendance Overview</div>
            <div>
                <b><i>Attendance Report List</i></b><br>
                <!--<core-label for="{{this.employeeid}}">Employee Name:{{employeename}}</core-label>-->
                <label type="hidden" id="empname" name="Employee Name:"><u><b>{{employeename}}</b></u></label>
            </div>
            <br>
            <!--for Date between <i>{{fromdate}}</i> and <i>{{todate}}</i>-->
            <div class="container">
                <page-er perpage="5"></page-er>
                <table id="mytable"  style="alignment-baseline: baseline;
                       alignment-adjust: central;  
                       text-align: center; 
                       font-style: oblique;
                       display: inline-block; 
                       resize: both; 
                       border: 2px solid #006;
                       border-collapse: collapse; 
                       padding: 2%;
                       width: 60%">
                    <thead><tr>
                    <template if ="{{!employeeid}}" >
                        <th>Employee First Name</th>
                        <th>Employee Last Name</th>
                    </template>
                    <th>Attendance Date</th>
                    <th>CheckIn Time</th>
                    <th>CheckOut Time</th>
                    </tr></thead>
                    <tbody>
                    <!--<template id="attendance" repeat="{{attendance in employeeattendance}}">-->
                        <template id="attendance" repeat="{{attendance}}">
                            <tr>
                            <template if ="{{!employeeid}}">
                                <td>{{attendance.FirstName}}</td>
                                <td>{{attendance.LastName}}</td>
                            </template>
                            <td>{{attendance.Attendence | date (yyyy/mm/dd)}}</td>
                            <td>{{attendance.timein | date('HH-mm-ss')}}</td>
                            <td> {{(attendance.timein === attendance.timeout) ? '' : attendance.timeout | date('HH-mm-ss') }}</td> 
                            </tr>
                        </template>
                        </tbody>
                </table>
                <select name="options" id="options">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                </select>
                <span>per page</span>
            </div>
            <paper-toast id="toast1" text="" on-click="{{dataResponse(el)}}" opened="false"></paper-toast>

        </sidebar-layout>
        <app-ajax id="ajax"
                  url="/api/employeeattendence/report"
                  method="GET"
                  on-core-response="{{reportResponse}}"
                  content-type="application/json"
                  handleAs="json">
        </app-ajax>
        <app-ajax id="ajax1"
                  url="/api/employee/:EmployeeID"
                  method="GET"
                  on-core-response="{{employeeResponse}}"
                  content-type="application/json"
                  handleAs="json">
        </app-ajax>

    </template>
    <script>
        Polymer('attendance-view-page', {
            domReady : function(){
                
                this.employeeattendance = this.employeeattendance || [];
                var fromdate = this.fromdate;
                var todate = this.todate;
                var EmployeeID = this.employeeid;
                var employeeid = this.employeeid;
                if(employeeid != '') {
                    this.$.ajax1.data = {employeeid:employeeid};
                    this.$.ajax1.go();
                    this.$.empname.type=true;
                
                }
                this.access_token = this.$.globals.baasicUser.accessToken;
                this.$.ajax.data = {fromdate:fromdate, todate:todate, EmployeeID:EmployeeID};
                this.$.ajax.go();
            
            },
            reportResponse : function(){
                if(this.$.ajax.response.status==true)
                {
                    console.log(this.$.ajax.response.data);
                    //                    for(var i=0;i<this.$.ajax.response.data.length;i++)
                    //                    {
                    //                        if(this.$.ajax.response.data[i].timein == this.$.ajax.response.data[i].timeout)
                    //                        {
                    //                            console.log(moment().duration().get(this.$.ajax.response.data[i].timein));
                    //                            this.$.ajax.response.data[i].timeout  = null;
                    //                        }
                    //                        else
                    //                        {
                    //                            this.$.ajax.response.data[i] = this.$.ajax.response.data[i];
                    //                        }
                    //                    }
                    // Select the grid/table where your main data will appear
                    
                    // Select the grid/table where your main data will appear
                    var t = document.querySelector("#items");

                    // Select the paginator to use with this element
                    var m = document.querySelector("page-er");

                    // Select options
                    var s = document.querySelector("#options");

                    // Create a model we will populate with data
                    //                    var model = {
                    //                        items: []
                    //                    };
                    //
                    //                    // As this is an example, populate some sample data inside
                    //                    for (var i = 1; i < 50; i++) {
                    //                        model.items.push({
                    //                            id: i,
                    //                            name: "Item "+ i,
                    //                            description: "description " + i
                    //                        });
                    //                    }

                    document.addEventListener('polymer-ready', function() {
                        // 1. Pass as `data` the set of data we want the
                        // paginator to paginate
                        m.data = this.employeeattendance;
                    });

                    document.addEventListener('pager-data', function(e) {
                        // 2. Update the current template/view with our
                        // paginated set of data. `pager-data` is fired
                        // when this has completed
                        t.model = { attendance: e.detail.data };
                    });

                    // 3. Anytime our paged set changes, update the view
                    document.addEventListener('pager-change', function(e) {
                        t.model = { attendance: e.detail.data };
                    });

                    this.$.options.addEventListener('change', function(e){
                        m.perpage = parseInt(this.options[this.selectedIndex].value, 10);
                        m.currentpage = 0;
                    });
                    
                    
                }
                else
                {
                    this.$.toast1.text="There Is an Error on Attendance Report Request/Response";
                    this.$.toast1.opened="true";
                }
                
            },
            employeeResponse: function()
            {
                if(this.$.ajax1.response.status==true)
                {
                    this.employeename = (this.$.ajax1.response.data[0].FirstName +' '+ this.$.ajax1.response.data[0].LastName);
                }
                else
                {
                    this.$.toast1.text="There is an Error on Employees Request/Response";
                    this.$.toast1.opened="true";
                }
            },
            dataResponse : function(el)
            {
                el.show();
            }
            
        });
    </script>

</polymer-element>