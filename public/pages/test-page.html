


<!--<link rel="import" href="/bower_components/polymer/polymer.html">-->
<link rel="import" href="/bower_components/core-scroll-threshold/core-scroll-threshold.html">
<link rel="import" href="/pages/app-ajax.html">
<script src="/pages/date.js"></script>


<polymer-element name="test-page" layout vertical attribute="employeeattendance">
    <template>
        <sidebar-layout selected="test">
            <style>
                #scroller {
                    height: 300px;
                    border: 1px solid red;
                    padding: 20px;
                    overflow: auto;
                }
                .thing {
                    padding: 10px;
                    margin: 10px;
                    background: lightblue;
                    border-radius: 10px;
                    font-size: 2em;
                }
            </style>

            <core-scroll-threshold id="threshold" scrollTarget="{{$.scroller}}" lowerThreshold="100" on-lower-trigger="{{loadMore}}" fit></core-scroll-threshold>
            <div id="scroller" fit>
                <template repeat="{{attendance in employeeattendance}}">
                    <div class="thing">Attendance Date:{{attendance.Attendence | date(yyyy/mm/dd)}}Employee Name:{{attendance.FirstName}} {{attendance.LastName}} CheckIn Time:{{attendance.timein | date('HH-mm-ss')}} CheckOut Time:{{(attendance.timein === attendance.timeout) ? '' : attendance.timeout | date('HH-mm-ss') }}</div>
                </template>
                <div hidden?="{{!$.threshold.lowerTriggered}}">Please wait...</div>
            </div> 
        </sidebar-layout>
        <app-ajax id="ajax"
                  url="/api/employeeattendence/report"
                  method="GET"
                  on-core-response="{{reportResponse}}"
                  content-type="application/json"
                  handleAs="json">
        </app-ajax>
    </template>

    <script>
        Polymer('test-page',{
            //            ready : function() {
            //                var scope = this;
            //                var n;
            //                scope.data = [];
            //                for (n=0; n<20; n++) {
            //                    scope.data.push(n);
            //                }
            //                console.log(scope.data);
            //                scope.loadMore = function() {
            //                    setTimeout(function() {
            //                        for (var i=n; i<n+10; i++) {
            //                            scope.data.push(i);
            //                        }
            //                            
            //                        n = i;
            //                        scope.$.threshold.clearLower();
            //                    }, 1000);
            //                };
            //            },
            domReady : function(){
                
                this.employeeattendance = this.employeeattendance || [];
                var fromdate = '2014/01/01';
                var todate = '2015/01/01';
                var EmployeeID = '4';
//                var employeeid = '4';
//                if(employeeid != '') {
////                    this.$.ajax1.data = {employeeid:employeeid};
////                    this.$.ajax1.go();
////                    this.$.empname.type=true;
//                
//                }
//                this.access_token = this.$.globals.baasicUser.accessToken;
                console.log(fromdate,todate,EmployeeID);
                this.$.ajax.data = {fromdate:fromdate, todate:todate, EmployeeID:EmployeeID};
                this.$.ajax.go();
            
            },
            reportResponse : function(){
                if(this.$.ajax.response.status==true)
                {
                    console.log(this.$.ajax.response.data);
                    //                    for(var i=0;i<this.$.ajax.response.data.length;i++)
                    //                    {
                    //                        if(this.$.ajax.response.data[i].timein == this.$.ajax.response.data[i].timeout)
                    //                        {
                    //                            console.log(moment().duration().get(this.$.ajax.response.data[i].timein));
                    //                            this.$.ajax.response.data[i].timeout  = null;
                    //                        }
                    //                        else
                    //                        {
                    //                            this.$.ajax.response.data[i] = this.$.ajax.response.data[i];
                    //                        }
                    //                    }
                    
                    this.employeeattendance = this.$.ajax.response.data;
                }
                else
                {
                    this.$.toast1.text="There Is an Error on Attendance Report Request/Response";
                    this.$.toast1.opened="true";
                }
                
            },
            employeeResponse: function()
            {
                if(this.$.ajax1.response.status==true)
                {
                    this.employeename = (this.$.ajax1.response.data[0].FirstName +' '+ this.$.ajax1.response.data[0].LastName);
                }
                else
                {
                    this.$.toast1.text="There is an Error on Employees Request/Response";
                    this.$.toast1.opened="true";
                }
            },
            dataResponse : function(el)
            {
                el.show();
            }
            
        });
    </script>
</polymer-element>
